# PRP-005: Friends & Favors System

## Description
Implement friends management via memories (admin-defined) and favors system where friends can request bot actions using "kawai, nya" triggers.

## Requirements
- Friends defined in memories by admins
- Friend detection from memory system
- Favor detection: "kawai, nya" keywords in messages
- Expose Telegram API to friends (send messages, forward, etc.)
- Web search capability for friends
- Other tools access based on favor requests
- Friends can ask bot to do anything within Telegram API capabilities

## Definition of Ready (DOR)
- [x] Memory system implemented (from PRP-004)
- [x] PostgreSQL database setup (from PRP-003)
- [ ] Telegram API capabilities reviewed
- [ ] Web search tool selected and configured

## Definition of Done (DOD)
- [ ] Friend detection from memories implemented
- [ ] Favor keyword detection ("kawai, nya") working
- [ ] Telegram API actions exposed to friends
- [ ] Web search tool integrated
- [ ] Tool access control (only friends + admins)
- [ ] Handler for favor requests created
- [ ] Unit tests for friend detection
- [ ] Unit tests for favor keyword detection
- [ ] E2E test for friend favor request flow

## Progress
- [ ] Implement friend detection in services/memory_service.py
- [ ] Create handlers/favors.py for favor requests
- [ ] Implement favor keyword detection ("kawai, nya")
- [ ] Create services/tool_service.py for tool execution
- [ ] Integrate Telegram API actions (send_message, forward, etc.)
- [ ] Integrate web search tool (e.g., DuckDuckGo API)
- [ ] Implement tool access control (friends + admins only)
- [ ] Parse favor requests and execute actions
- [ ] Write unit tests for friend detection
- [ ] Write unit tests for favor keyword detection
- [ ] Write unit tests for tool execution
- [ ] Write E2E test for friend favor flow

## Notes
- Friend memory example: "user_id:123456 is friend of admin"
- Favor trigger: message contains "kawai, nya" or similar kawai expressions
- Telegram API actions:
  - send_message(chat_id, text)
  - forward_message(from_chat, to_chat, message_id)
  - pin_message(chat_id, message_id)
  - etc.
- Web search: use DuckDuckGo API or similar
- Tools framework: registry of available tools, execution engine
- Access control: check if user is admin or friend before executing favor

## Agent Comments
<!-- Add progress notes here as you work on this PRP -->
