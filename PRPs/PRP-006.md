# PRP-006: Joking System with Learning

## Description
Implement joke detection and generation system with reaction-based learning. Bot learns from likes/reactions to improve joke quality over time.

## Requirements
- Joke opportunity detection in messages
- **Joke generation in русский, English, emoji mix**
- **Transliteration jokes** (кавай = kawai, комфортный = comfortny)
- Multiple joke formulas (setup/punchline, wordplay, transliteration, etc.)
- Track reactions (likes) on bot's jokes
- Learn from reactions: avoid no-like jokes, repeat liked patterns
- Store joke history and reaction stats in database
- Integrate with RAG for context-aware jokes

## Definition of Ready (DOR)
- [x] PostgreSQL database setup (from PRP-003)
- [ ] Joke model designed
- [ ] LLM API access configured (OpenAI or similar)
- [ ] Joke formulas defined

## Definition of Done (DOD)
- [ ] Joke model created in models/joke.py
- [ ] Joke service created in services/joke_service.py
- [ ] Joke opportunity detection implemented
- [ ] Joke generation with LLM implemented
- [ ] Reaction tracking implemented
- [ ] Learning algorithm implemented (like/no-like analysis)
- [ ] Multiple joke formulas supported
- [ ] Multilingual joke generation working
- [ ] Unit tests for joke generation
- [ ] Unit tests for reaction learning
- [ ] E2E test for joke flow with reaction

## Progress
- [ ] Design Joke model (id, message_id, joke_text, joke_type, reactions, created_at)
- [ ] Create models/joke.py
- [ ] Create services/joke_service.py
- [ ] Implement joke opportunity detection (analyze message context)
- [ ] Integrate LLM for joke generation (OpenAI API)
- [ ] Implement joke formulas (setup/punchline, pun, observation, etc.)
- [ ] Implement reaction tracking (listen to message reactions)
- [ ] Implement learning algorithm (analyze reaction patterns)
- [ ] Store jokes and reactions in database
- [ ] Implement multilingual joke generation
- [ ] Write unit tests for joke opportunity detection
- [ ] Write unit tests for joke generation
- [ ] Write unit tests for reaction learning
- [ ] Write E2E test for joke generation and reaction

## Notes
- Joke types:
  - setup/punchline
  - wordplay/pun
  - observational humor
  - kawai expressions with humor
- Reaction tracking: listen to Telegram reaction updates
- Learning: if joke has 0 reactions → store pattern, avoid similar
- Learning: if joke has >0 reactions → store pattern, generate similar
- LLM prompt: include context, language, joke type, past successful patterns
- Store joke metadata: type, language, context, reactions count

## Agent Comments
<!-- Add progress notes here as you work on this PRP -->
