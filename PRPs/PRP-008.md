# PRP-008: Cron Tasks & Summary Generation

## Description
Implement self-managed cron task system for periodic operations, including RAG-based summarization of chat history into short, useful summaries.

## Requirements
- Cron task management system
- Bot can create, schedule, and execute cron tasks
- Periodic RAG summarization task (daily/weekly)
- Summarize all history messages and facts into short summaries
- Store summaries as memories or separate summaries table
- Task execution engine with scheduling
- Admin commands to manage cron tasks

## Definition of Ready (DOR)
- [x] PostgreSQL database setup (from PRP-003)
- [x] RAG system implemented (from PRP-007)
- [x] Memory system implemented (from PRP-004)
- [ ] Cron task model designed
- [ ] Scheduling library selected (APScheduler)

## Definition of Done (DOD)
- [ ] CronTask model created in models/cron_task.py
- [ ] Cron service created in services/cron_service.py
- [ ] Task scheduling engine implemented (APScheduler)
- [ ] RAG summarization task implemented
- [ ] Summaries stored in database
- [ ] Admin commands for cron management (/add_task, /list_tasks, /delete_task)
- [ ] Periodic summarization working
- [ ] Unit tests for cron task scheduling
- [ ] Unit tests for summarization task
- [ ] E2E test for cron task execution

## Progress
- [ ] Add APScheduler to requirements.txt
- [ ] Design CronTask model (id, name, schedule, task_type, params, is_active, created_at)
- [ ] Create models/cron_task.py
- [ ] Create services/cron_service.py
- [ ] Implement task scheduling with APScheduler
- [ ] Implement RAG summarization task
- [ ] Create Summary model or use Memory for summaries
- [ ] Implement /add_task admin command
- [ ] Implement /list_tasks admin command
- [ ] Implement /delete_task admin command
- [ ] Integrate cron service with bot startup
- [ ] Write unit tests for cron scheduling
- [ ] Write unit tests for RAG summarization
- [ ] Write E2E test for cron task execution

## Notes
- APScheduler: Python task scheduling library
- Cron task types:
  - rag_summary: summarize chat history
  - cleanup: clean old messages
  - backup: backup database
  - custom: admin-defined tasks
- RAG summarization workflow:
  1. Retrieve all messages from last period
  2. Use RAG to extract key topics and facts
  3. Generate summary with LLM
  4. Store summary in database
- Summary storage: can use Memory table or create separate Summary table
- Schedule examples: "daily at 3am", "weekly on Sunday", "every 6 hours"

## Agent Comments
<!-- Add progress notes here as you work on this PRP -->
